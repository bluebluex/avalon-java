### JVM

#### Java虚拟机概述和基本概念

​	系统虚拟机(Visual Box VM)和程序虚拟机(HotSpot)

​	桥接：同一个网段、DNS，不同网卡使用的通信协议不一样的

​	hostonly：虚拟机间、虚拟机和本地能ping通，虚拟机不能访问外网

​	NAT(vmnet8)：共享主机的IP地址，网络地址转换；子网IP：同网段；网关/DHCP设置；IPV4设置同网关

​	

Hot Sport VM

堆分配参数：

- -Xmn：设置新生代大小，设置一个比较大的新生代会减少老年代的大小，这个参数对系统性能以及GC行为又很大影响，新生代大小一般会设置整个堆空间的1/3到1/4左右
  - 不同的堆分布情况，对系统执行会产生一定的影响，基本策略：尽可能将对象预留在新生代，减少老年代的GC次数
  - -XX:SurvivorRatio：Eden:s0:s1

- -XX:+HeapDumpOnOutofMemoryError -XX:HeapDumpPath=c:/error.dump
- -XX:MaxPermSize/-XX:PermSize：默认64M；方法区和堆一样，线程共享，用于保存系统的类信息，如果系统运行时生产大量的类，就需要设置一个享对何时的方法区，以免出现永久去内存溢出问题



#### 内存结构

线程共享区：

- **方法去区**：运行时常量，静态常量，加载的类信息，编译后的代码等
  - 类的版本 | 字段 | 方法 | 接口
  - 方法区和永久代
  - 
- **堆**：存放对象实例 | 垃圾收集器管理的主要区域
  - 新生代：
    - Eden | 
    - Survivor0 | 
    - Survivor1
  - 老年代：



线程独占区：

- **虚拟机栈**：
  - 虚拟机栈描述的是Java方法执行的动态内存模型
  - 栈帧：
    - 每个方法执行，都会创建一个栈帧，伴随着方法从创建到执行完成；用于存储局部变量表，操作数栈，动态链接，方法出口等
  - 局部变量表
    - 存放编译期可知的各种基本数据类型，引用类型，returenAddress类型
  - 大小：StackOverflowError| OutofMemoryError
- **本地方法栈**：
  - HotSports不区分本地方法栈和虚拟机栈；执行native方法服务；
- **程序计数器**：
  - 程序计数器是一块比较小的内存空间，可以看做当前线程所执行的字节码的行号指示器；
  - 程序计数器处于线程独占区
  - 线程执行的是Java方法，记录的是正在执行的虚拟机字节码指令的地址；执行的是native方法，值为undefined
  - 此区域是唯一一个在Java虚拟机规范中没有规定任务OOM的区域



#### 垃圾回收机制

可达性分析算法：

- 虚拟机栈：变量表
- 方法区中常量
- 方法去的类属性
- 本地方法

算法：

- 标记-清除算法：空间碎片影响效率；
- 复制算法：from / to 
- 标记-压缩：老年代；即在标记清除基础上把存活的对象压缩到内存一端
- 分代收集



#### 性能监控工具



